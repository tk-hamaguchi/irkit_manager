require 'spec_helper'

RSpec.describe IrkitManager::Decoder do
  subject { described_class }

  context '#execute!' do
    context 'with args,' do
      context 'for example' do
        sample_data = [
          [4713, 1190, 2368, 1190, 1190, 1190, 2368, 1190, 1190, 1190, 2368, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 2368, 1190, 2368, 1190, 1190, 1190, 1190, 42612, 4713, 1190, 2368, 1190, 1190, 1190, 2368, 1190, 1190, 1190, 2368, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 1190, 2368, 1190, 2368, 1190, 1190, 1190, 1190, 42612, 4713, 1150, 2368, 1150, 1150, 1150, 2368, 1150, 1150, 1150, 2368, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 1150, 2368, 1150, 2368, 1150, 1150, 1150, 1150],
          [6881, 3458, 873, 873, 873, 873, 873, 2537, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 873, 873, 873, 873, 873, 873, 2537, 873, 2537, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 2537, 873, 2537, 873, 2537, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 787, 873, 65535, 0, 65535, 0, 19315, 6881, 3458, 873, 873, 873, 873, 873, 2537, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 873, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 2537, 873, 873, 873, 787, 935, 2537, 873, 873, 873, 873, 873, 873, 873, 873, 873, 761, 873, 2537, 935, 2537, 935, 2537, 935, 843, 843, 2537, 843, 843, 843, 843, 843, 2537, 843, 2537, 843, 2537, 843, 843, 843, 843, 843, 2537, 843, 843, 843, 843, 843]
        ]
        expect_data = [
          [ IrkitManager::Data::Sony.new(func_code: 84, id_code: 12),
            IrkitManager::Data::Sony.new(func_code: 84, id_code: 12),
            IrkitManager::Data::Sony.new(func_code: 84, id_code: 12) ],
          [ IrkitManager::Data::Aeha.new(customer_code: 13386, data: [0, 116, 228]),
            IrkitManager::Data::Aeha.new(customer_code: 13386, data: [0, 116, 228]) ]
        ]

        sample_data.each_with_index do |sample, i|
          context sample do
            subject { IrkitManager::Decoder.execute!(sample) }
            it { is_expected.to eq expect_data[i] }
          end
        end
      end
    end
    context 'with noargs' do
      subject { super().execute! }
      it { expect{subject}.to raise_error ArgumentError }
    end
  end
end
